<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <title></title>
    <link rel="stylesheet" href="./ui/css/index.css">
</head>
<body>
<!--主界面-->
<div id="main" class="fonts" style="height: 420px;">
    <!--Sidebar includes "App Name" "New File" "Edit"-->
    <div class="side">
        <!--Archive Markdown Editor Title-->
        <div class="title">
            <!--Icon-->
            <div class="dr">
                <svg viewBox="0 0 1002 927" style="width: 50px; height: 50px;" width="1002" height="927"
                     xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"
                     overflow="hidden"><defs><clipPath id="clip0"><rect x="743" y="380" width="1002" height="927"/></clipPath></defs>
                    <g clip-path="url(#clip0)" transform="translate(-743 -380)"><path d="M1035.17 963.18 1038.78 961.052 1146.35 1080.68 1143.85 1084.04C1110.48 1114.05 1059.09 1111.32 1029.08 1077.95 999.072 1044.58 1001.8 993.191 1035.17 963.18Z" stroke="#000000" stroke-width="27.5" stroke-miterlimit="8" fill="#FFFFFF" fill-rule="evenodd"/>
                        <path
                                d="M1116.5 516C1246.56 516 1352 621.355 1352 751.316 1352 881.278 1246.56 986.633 1116.5 986.633L1110.01 985.979 1110.01 1078 983.565 971.177C937.995 932.679 907.372 883.073 892.314 829.699L887.992 805.846 885.785 798.741 884.629 787.283 882.465 775.342 882.535 769.548 882.839 769.548 881 751.316C881 621.355 986.437 516 1116.5 516Z"
                                stroke="#000000" stroke-width="27.5" stroke-miterlimit="8" fill="#FFC000"
                                fill-rule="evenodd"/>
                        <path
                                d="M1021.61 579.196 1116.22 625.818 1199.93 579.638 1220.77 597.062 1220.77 597.062C1280.66 657.859 1281.77 753.861 1223.27 811.487L1117.33 915.83 1008.9 805.747C949.02 744.95 947.905 648.948 1006.41 591.322Z"
                                stroke="#000000" stroke-width="27.5" stroke-miterlimit="8" fill="#FFC000"
                                fill-rule="evenodd"/>
                        <path
                                d="M1170.83 610.286 1183.96 621.182 1183.96 621.182C1221.56 659.357 1221.1 720.788 1182.92 758.39L1113.8 826.474 1045.71 757.35C1008.11 719.174 1008.58 657.744 1046.75 620.142L1056.64 612.195 1116.65 640.871Z"
                                fill="#FFE699" fill-rule="evenodd"/>
                        <path
                                d="M1121.36 1097 1119 1096.17 1119 934.831 1121.36 934C1147.12 934 1168 970.489 1168 1015.5 1168 1060.51 1147.12 1097 1121.36 1097Z"
                                stroke="#000000" stroke-width="27.5" stroke-miterlimit="8" fill-rule="evenodd"/>
                        <path d="M0 51.4799 38.8601 0 166.423 0 127.563 51.4799Z" fill-rule="evenodd"
                              transform="matrix(-0.75471 -0.656059 -0.656059 0.75471 1167.02 1043.57)"/>
                        <path d="M0 51.4799 38.8601 0 95.037 0 56.1769 51.4799Z" fill-rule="evenodd"
                              transform="matrix(-0.674622 -0.738163 -0.738163 0.674622 1168.19 991.865)"/>
                        <path
                                d="M1173.28 967.595 1209.89 938.244C1229.62 919.964 1249.93 898.704 1269.78 875.152 1289.63 851.599 1307.14 827.985 1321.81 805.449L1336.13 779.588 1333.5 809.536C1326.47 836.201 1309.87 867.231 1285.37 896.307 1260.86 925.382 1233.09 946.997 1208 958.44Z"
                                fill="#FFFFFF" fill-rule="evenodd"/>
                        <path
                                d="M54.01 81.1547C46.8068 108.539 29.582 119.353 15.5372 105.308 13.6532 103.424 11.8824 101.138 10.2574 98.4908Z"
                                fill="#FFFFFF" fill-rule="evenodd"
                                transform="matrix(0.793383 -0.608722 -0.608722 -0.793383 1226.57 1049.41)"/>
                        <path d="M1200.88 757.851 1129.5 742.5" stroke="#000000" stroke-width="4.58333"
                              stroke-miterlimit="8" fill="none" fill-rule="evenodd"/>
                        <path d="M1193.3 772.783 1129.5 749.5" stroke="#000000" stroke-width="4.58333"
                              stroke-miterlimit="8" fill="none" fill-rule="evenodd"/>
                        <path d="M1184.96 791.022 1129.5 757.5" stroke="#000000" stroke-width="4.58333"
                              stroke-miterlimit="8" fill="none" fill-rule="evenodd"/>
                        <path d="M0 0 0.000360892 56.8777" stroke="#000000" stroke-width="4.58333" stroke-miterlimit="8"
                              fill="none" fill-rule="evenodd" transform="matrix(1 0 0 -1 1113.5 783.378)"/>
                        <path
                                d="M1113.62 781.714C1110.26 789.493 1100.31 791.096 1091.39 785.293 1089.68 784.185 1088.09 782.847 1086.67 781.332"
                                stroke="#000000" stroke-width="4.58333" stroke-miterlimit="8" fill="none"
                                fill-rule="evenodd"/>
                        <path
                                d="M10.204 0.974339C17.9753-2.40357 26.3347 3.23468 28.8752 13.5677 29.3606 15.5423 29.608 17.6066 29.608 19.684"
                                stroke="#000000" stroke-width="4.58333" stroke-miterlimit="8" fill="none"
                                fill-rule="evenodd"
                                transform="matrix(0.729652 0.683818 0.683818 -0.729652 1103.27 775.638)"/>
                        <path d="M0 0 71.3805 15.3513" stroke="#000000" stroke-width="4.58333" stroke-miterlimit="8"
                              fill="none" fill-rule="evenodd" transform="matrix(1 0 0 -1 1025.5 757.851)"/>
                        <path d="M0 0 63.7968 23.283" stroke="#000000" stroke-width="4.58333" stroke-miterlimit="8"
                              fill="none" fill-rule="evenodd" transform="matrix(1 0 0 -1 1033.5 773.783)"/>
                        <path d="M0 0 55.4551 33.5219" stroke="#000000" stroke-width="4.58333" stroke-miterlimit="8"
                              fill="none" fill-rule="evenodd" transform="matrix(1 0 0 -1 1041.5 792.022)"/>
                        <path
                                d="M1166.58 699.926C1159.06 707.618 1146.73 707.756 1139.04 700.235 1134.4 695.696 1129.75 691.157 1125.11 686.617 1129.65 681.975 1134.19 677.332 1138.73 672.689 1146.25 664.997 1158.58 664.859 1166.27 672.38 1173.97 679.901 1174.11 692.234 1166.58 699.926Z"
                                fill="#FFFFFF" fill-rule="evenodd"/>
                        <path
                                d="M1141.45 671.248C1149.76 664.424 1162.04 665.635 1168.86 673.952 1172.98 678.972 1177.1 683.992 1181.22 689.012 1176.2 693.13 1171.18 697.248 1166.16 701.367 1157.84 708.19 1145.57 706.979 1138.74 698.662 1131.92 690.345 1133.13 678.071 1141.45 671.248Z"
                                fill="#FFFFFF" fill-rule="evenodd"/>
                        <path
                                d="M0 19.5001C-1.01849e-15 8.73049 3.58168-2.48262e-15 7.9999-4.96525e-15 12.4181-9.93049e-15 15.9998 8.73049 15.9998 19.5001 15.9998 30.2697 12.4181 39.0002 7.9999 39.0002 3.58168 39.0002-5.09247e-15 30.2697 0 19.5001Z"
                                fill-rule="evenodd" transform="matrix(-1 0 0 1 1162 668)"/>
                        <path
                                d="M1086.56 697.594C1079.04 705.286 1066.71 705.425 1059.02 697.904 1054.37 693.364 1049.73 688.825 1045.09 684.285 1049.63 679.643 1054.17 675 1058.71 670.358 1066.23 662.666 1078.56 662.527 1086.25 670.048 1093.95 677.569 1094.08 689.902 1086.56 697.594Z"
                                fill="#FFFFFF" fill-rule="evenodd"/>
                        <path
                                d="M1061.43 668.916C1069.74 662.092 1082.02 663.303 1088.84 671.62 1092.96 676.64 1097.08 681.66 1101.2 686.68 1096.18 690.798 1091.16 694.917 1086.14 699.035 1077.82 705.859 1065.55 704.648 1058.72 696.331 1051.9 688.013 1053.11 675.74 1061.43 668.916Z"
                                fill="#FFFFFF" fill-rule="evenodd"/>
                        <path
                                d="M0 19.0001C-1.01852e-15 8.50663 3.58176-2.41896e-15 8.00008-4.83793e-15 12.4184-9.67586e-15 16.0002 8.50663 16.0002 19.0001 16.0002 29.4935 12.4184 38.0002 8.00008 38.0002 3.58176 38.0002-5.09259e-15 29.4935 0 19.0001Z"
                                fill-rule="evenodd" transform="matrix(-1 0 0 1 1082 666)"/>
                        <text font-family="Inconsolata,Inconsolata_MSFontService,sans-serif" font-weight="700"
                              font-size="83" transform="matrix(1 0 0 1 1191.01 1047)">cott<tspan font-size="83"
                                                                                                 x="206.25"
                                                                                                 y="0">Smith</tspan>
                            <tspan font-size="83" x="0" y="99">is</tspan>
                            <tspan fill="#C00000" font-size="83" x="103.125" y="99">HERE</tspan></text>
                    </g>
                </svg>
            </div>
            <!--Name-->
            <div style="font-weight: bold; color: #42b883;">Archive Markdown Editor</div>
        </div>
        <!--Separator-->
        <div class="separator"></div>
        <!--New File-->
        <div class="options" id="new">新建文件</div>
        <!--Open-->
        <div class="options" id="open" @click="openFile">打开文件</div>
        <!--Quit-->
        <div class="options-quit" id="quit" @click="quitApp">退出Archive Markdown Editor</div>
    </div>
    <!--Main area is showing recent files, 8 files max-->
    <div id="recent-file-list" style="overflow: scroll; height: 100%;">
        <div>
            <!--Recent file title-->
            <div class="recent-file-title">
                <div class="recent-file-title-body">
                    <div class="block"></div>
                    <div style="width: 6px;"></div>
                    <div style="font-weight: bold; font-size: 20px;">历史记录</div>
                </div>
                <div v-if="histories.length !== 0" class="clear-all-history" @click="clearAllHistory();">清空</div>
            </div>
            <!--Separator-->
            <div class="separator"></div>
            <!--Recent file unit-->
            <template v-if="histories.length === 0">
                <div style="color: #6a737d;">曾打开的文件将显示于此处。</div>
            </template>
            <template v-else>
                <div class="recent-file-unit" v-for="(item, index) in histories" :key="index">
                    <div class="file-info-block">
                        <!--File icon-->
                        <div>
                            <svg style="width: 40px; height: 40px;" t="1748343387536" class="icon" viewBox="0 0 1024 1024"
                                 version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11531" width="200" height="200">
                                <path d="M554.666667 384 554.666667 149.333333 789.333333 384M256 85.333333C208.64 85.333333 170.666667 123.306667 170.666667 170.666667L170.666667 853.333333C170.666667 900.266667 209.066667 938.666667 256 938.666667L768 938.666667C814.933333 938.666667 853.333333 900.266667 853.333333 853.333333L853.333333 341.333333 597.333333 85.333333 256 85.333333Z"
                                      p-id="11532" data-spm-anchor-id="a313x.search_index.0.i0.3f013a81s5EGQ2" class="selected"
                                      fill="#42b883"></path>
                            </svg>
                        </div>
                        <div style="width: 10px;"></div>
                        <!--Info-->
                        <div>
                            <div>
                                <!--File name-->
                                <div class="access-file" @click="openFileFromHistory(item.opened_file_path);">
                                    {{ item.opened_file_path.split(sep).pop() }}
                                </div>
                                <!--File path-->
                                <div class="access-file-path">{{ item.opened_file_path }}</div>
                            </div>
                            <!--Date and time-->
                            <div class="last-open-date-time">上次打开时间: {{ item.open_datetime }}</div>
                        </div>
                    </div>
                    <!--Delete icon-->
                    <div style="cursor: pointer;" @click="deleteHistory(item.opened_file_path);">
                        <svg style="width: 30px; height: 30px;" t="1748343561453" class="icon" viewBox="0 0 1024 1024"
                             version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14232" width="200" height="200">
                            <path d="M256 810.666667c0 46.933333 38.4 85.333333 85.333333 85.333333l341.333333 0c46.933333 0 85.333333-38.4 85.333333-85.333333L768 298.666667 256 298.666667 256 810.666667zM810.666667 170.666667l-149.333333 0-42.666667-42.666667-213.333333 0-42.666667 42.666667L213.333333 170.666667l0 85.333333 597.333333 0L810.666667 170.666667z"
                                  p-id="14233" data-spm-anchor-id="a313x.search_index.0.i5.3f013a81s5EGQ2" class="selected"
                                  fill="#c21f0a"></path>
                        </svg>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>
</body>
<script src="./libs/third_party/vue3/vue.global.prod.js"></script>
<script>
    const {createApp} = Vue;
    const app = createApp({
        data() {
            return {
                histories: [],
                sep: '',
            };
        },
        methods: {
            quitApp() {
                window.qt.quit();
            },
            openFile() {
                window.openNewWindow.openFile();
                window.close();
            },
            openFileFromHistory(path) {
                window.openNewWindow.openFileFromPath(path);
                window.close();
            },
            async deleteHistory(path) {
                window.histories.delHistory(path, false);
                let historiesAndSystem = await window.histories.getPermanentHistory();
                this.histories = this.rankHistory(historiesAndSystem[0]);
            },
            async clearAllHistory() {
                window.histories.delHistory("", true);
                let historiesAndSystem = await window.histories.getPermanentHistory();
                this.histories = this.rankHistory(historiesAndSystem[0]);
            },
            rankHistory(historyList) {
                historyList.sort((a, b) => (b.open_timestamp - a.open_timestamp));
                return historyList;
            },
        },
        async created() {
            // 获取并展示文件打开历史记录
            let historiesAndSystem = await window.histories.getPermanentHistory();
            // 对获取的历史记录列表以时间进行排序，保证最新的记录处于靠前的位置

            this.histories = this.rankHistory(historiesAndSystem[0]);
            this.sep = historiesAndSystem[1];
        },
        async mounted() {
            // 新建文件，打开新的Work窗口，并关闭主窗口
            document.getElementById("new").addEventListener("click", () => {
                window.openNewWindow.openNew();
                window.close();
            });

            // 快捷键关闭页面
            window.addEventListener("keydown", function (event) {
                // 判断是否按下了Ctrl/Command键和 W 键
                if (event.ctrlKey && event.key === "w") {  // Windows
                    window.close();
                }
                if (event.metaKey && event.key === "w") {  // macOS
                    window.close();
                }
            });
        },
    });
    app.mount("#main");
</script>
</html>

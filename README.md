# Archive-Markdown-Editor

------

# Designed by Scott Smith —— <br> 提升Markdown易用性的新格式：*.mdz

### 介绍
1. 传统Markdown插入多媒体的本质是插入指定多媒体的位置信息（包括在线网址/离线文件路径），Markdown并未与多媒体文件强绑定，易出现多媒体丢失的问题，影响Markdown文章的阅读。
2. 该格式能在Markdown中有效嵌入多媒体文件等（图片、视频、音频，包括PDF、docx、pptx、xlsx等常见类型）。
3. 该文件格式本质是Zip压缩包，扩展名由原来的改成了*.mdz，名字来源：Markdown + Zip。本格式能将多媒体文件和Markdown有机结合，打包在一起，以后与人共享包含多媒体的Markdown文件时，仅需共享一个文件即可，不需要为零散的多媒体文件费心。
4. 而且，由于微软Office的*.docx文件过于笨重不灵活，且难以插入视频和音频（\*.pptx都可以随便插入视频和音频等多媒体，且能和多媒体一起打包进文件内部，搞不懂微软内部在干啥，不给\*.docx支持一下），因此我们亟需一种兼顾Markdown的轻巧灵活舒适和pptx对多媒体较强归档能力的格式。因此，*.mdz横空出世！

### 文件格式细节
1. 扩展名为*.mdz，如：file_name.mdz
2. 本质为Zip，将扩展名*.mdz改成*.zip后，可轻易用解压软件解压。
3. 解压后的文件结构如下：

```text
file_name
    ├── checksum
    └── mdz_contents
        ├── file_name.md
        ├── media_src
        │        └── media.jpg
        └── operate_history
            └── operate_log.txt
```
其中“file_name.md”是我们熟悉的Markdown文件，要求该文件的名字和原来的mdz文件名一致。 接下来看到“operate_history”文件夹，里面有2个文件。其中“operate_log.txt”是我们从打开mdz文件到完全关闭该文件的整个过程中记录任何对文件的更改操作，便于“撤销/重做”操作。根目录中的“checksum”文件则是记录保存操作后的mdz文件的sha1值，如更改内容后没保存，则sha1值与刚保存的不同，用于编辑器显示未保存星号显示功能。media_src文件用于存放多媒体。
4. 支持撤销/重做的操作：
```text
1. 文本内容的增删改
2. 导入多媒体时，如果进行撤销操作，则Markdown多媒体内容消失，并将本身导入的多媒体移到原目录中，进行重做操作则相反。
3. 注意：不支持对删除的多媒体执行撤销操作，也不能对内容中的多媒体执行重做操作以删除多媒体。
4. 注意：当在编辑器中点击保存或按下“Ctrl/Cmd + S”时，文件更改的内容仍可继续撤销。但执行关闭操作时，在文件关闭之前则会清空operate_history/operate_log.txt内的所有内容。
```

### 编辑器在新建*.mdz文件时的处理过程细节
新建文件时，编辑器会在临时目录（默认在用户目录，且不可见，可设置于别的目录）下创建“未命名/Untitled”文件夹，并生成mdz文件结构和必要的内容。

### 编辑器在保存新建的*.mdz文件时的处理过程细节
保存新建的文件时，编辑器将在临时目录（默认在用户目录，且不可见，可设置于别的目录）下创建的“未命名/Untitled”文件夹打包成mdz文件，保存在用户指定的目录。

### 编辑器在打开已有的*.mdz文件时的处理过程细节
编辑器在mdz文件所在目录解压mdz文件，解压后的文件夹在系统不可见，文件夹名称格式如：._mdz_content.file_name

### 编辑器在保存/另存为更改后已有的*.mdz文件时的处理过程细节
编辑器在保存时，首先清空operate_log.txt，然后进行打包压缩，保存至打开文件时所在的目录，并更改扩展名为mdz。另存为只是多了将Markdown文件名和文件夹名更改为用户指定文件名，并保存于用户指定目录。

### 编辑器在修复*.mdz文件时的处理过程细节
